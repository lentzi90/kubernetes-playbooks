- name: Add kubernetes repo
  yum_repository:
    name: Kubernetes
    file: kubernetes
    description: Kubernetes repository
    baseurl: https://packages.cloud.google.com/yum/repos/kubernetes-el7-{{ ansible_architecture }}
    gpgkey: https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
    gpgcheck: yes
    repo_gpgcheck: yes
  register: kubernetes_repo

- name: Refresh repo cache
  command: dnf clean metadata
  args:
    warn: no
  when: kubernetes_repo.changed

- name: Install parts
  dnf:
    name:
      - kubelet-{{ kubernetes_version }}
      - kubeadm-{{ kubernetes_version }}
      - kubectl-{{ kubernetes_version }}
      # Optional
      - iproute-tc
